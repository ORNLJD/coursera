define(["jquery","backbone","underscore","js/core/coursera","pages/home/template/body","pages/home/account/courseRecordListing.html","i18n!pages/home/account/nls/courseRecordListing","js/collections/topics","js/collections/courses","js/lib/uri"],function($,Backbone,_,Coursera,body,template,template_t,Topics,Courses,URI){var TYPES=["REGULAR_PASS","REGULAR_FAIL","REGULAR_NONE","SIGTRACK_PASS","SIGTRACK_AUTH_FAIL","SIGTRACK_CLASS_FAIL","ACE_PASS","ACE_AUTH_FAIL","ACE_ACE_FAIL","ACE_CLASS_FAIL"],distinctionSectionShowingRules=[{divClass:"coursera-course-listing-distinction-section",rules:{0:["DISTINCTION"]}},{divClass:"coursera-course-grading-policy-section",rules:{0:["DISTINCTION"],1:["NORMAL","FAIL"]}}],sectionShowingRules=[{divClass:"coursera-course-listing-grade-section",rules:{1:["ACE_PASS","ACE_AUTH_FAIL","ACE_ACE_FAIL","ACE_CLASS_FAIL"],0:["REGULAR_PASS","REGULAR_FAIL","REGULAR_NONE","SIGTRACK_PASS","SIGTRACK_AUTH_FAIL","SIGTRACK_CLASS_FAIL"]}},{divClass:"coursera-course-SOA-cert-section",rules:{0:["SIGTRACK_PASS","ACE_PASS","ACE_ACE_FAIL"],1:["REGULAR_PASS","SIGTRACK_AUTH_FAIL","ACE_AUTH_FAIL"],2:["SIGTRACK_AUTH_FAIL","ACE_AUTH_FAIL"],3:["REGULAR_FAIL","SIGTRACK_CLASS_FAIL","ACE_CLASS_FAIL"],4:["REGULAR_NONE"]}},{divClass:"coursera-share-buttons-section",rules:{0:["REGULAR_PASS","REGULAR_FAIL","SIGTRACK_AUTH_FAIL","SIGTRACK_CLASS_FAIL","ACE_AUTH_FAIL","ACE_ACE_FAIL","ACE_CLASS_FAIL"],1:["SIGTRACK_PASS","ACE_PASS"]}},{divClass:"coursera-course-grading-policy-header-course",rules:{0:["ACE_PASS","ACE_AUTH_FAIL","ACE_ACE_FAIL","ACE_CLASS_FAIL"]}},{divClass:"coursera-course-grading-policy-header-ace",rules:{0:["ACE_PASS","ACE_AUTH_FAIL","ACE_ACE_FAIL","ACE_CLASS_FAIL"]}}];return Backbone.View.extend({render:function(){var course=this.options.course,courseRecord=course.get("record"),courseGrade=0;if(!course.hasGrade())courseGrade=courseRecord.grade_normal||0;else courseGrade=2==courseRecord.achievement_level?courseRecord.grade_distinction:courseRecord.grade_normal;var aceGrade=0;if(courseRecord.is_enrolled_for_proctored_exam)aceGrade=courseRecord.ace_grade||0;var gradeType="REGULAR_FAIL";if(!course.get("eligible_for_certificates"))gradeType="REGULAR_NONE";else if(courseRecord.is_enrolled_for_proctored_exam)if(courseRecord.passed_ace||courseRecord.achievement_level>0)if(courseRecord.authenticated_overall)gradeType="ACE_PASS";else gradeType="ACE_AUTH_FAIL";else gradeType="ACE_CLASS_FAIL";else if(courseRecord.signature_track)if(courseRecord.achievement_level>0)if(courseRecord.authenticated_overall)gradeType="SIGTRACK_PASS";else gradeType="SIGTRACK_AUTH_FAIL";else gradeType="SIGTRACK_CLASS_FAIL";else if(courseRecord.achievement_level>0)gradeType="REGULAR_PASS";var distinctionType="NONE";if(2==courseRecord.achievement_level)distinctionType="DISTINCTION";else if(1==courseRecord.achievement_level)distinctionType="NORMAL";else if(course.get("eligible_for_certificates"))distinctionType="FAIL";var linkedinUrl="";if(course.get("eligible_for_certificates")&&courseRecord.achievement_level>0){var LINKEDIN_COURSERA_ID=2453129,LINKEDIN_COURSERA_ST_ID=3526187,linkedinAuthorityId,linkedinCertificationUrl,linkedinLicenseNo,linkedinTracking="Eml-prof-csra-"+this.options.course.get("topic").get("short_name")+"-os";if(courseRecord.signature_track&&courseRecord.authenticated_overall)linkedinAuthorityId=LINKEDIN_COURSERA_ST_ID,linkedinLicenseNo=this.options.course.get("record").verify_cert_id,linkedinCertificationUrl=Coursera.config.url.base+"signature/certificate/"+linkedinLicenseNo;else linkedinAuthorityId=LINKEDIN_COURSERA_ID,linkedinLicenseNo=null,linkedinCertificationUrl=Coursera.config.url.base+"course/"+this.options.course.get("topic").get("short_name");if(linkedinUrl=new URI("http://www.linkedin.com/profile/guided").addQueryParam("startTask","CERTIFICATION_NAME").addQueryParam("force","true").addQueryParam("pfCertificationName",this.options.course.get("topic").get("name")).addQueryParam("_mSplash",1).addQueryParam("pfCertStartDate",this.options.course.getEndDisplayShort("YYYYMM")).addQueryParam("trk",linkedinTracking).addQueryParam("pfAuthorityId",linkedinAuthorityId).addQueryParam("pfCertificationUrl",linkedinCertificationUrl),linkedinLicenseNo)linkedinUrl=linkedinUrl.addQueryParam("pfLicenseNo",linkedinLicenseNo)}this.$el.html(template({_:_,_t:template_t,config:Coursera.config,course:this.options.course,courseGrade:courseGrade.toFixed(1),aceGrade:aceGrade.toFixed(1),linkedinUrl:linkedinUrl.toString()}));for(var chosenType=[{type:gradeType,array:sectionShowingRules},{type:distinctionType,array:distinctionSectionShowingRules}],k=0;k<chosenType.length;k++)for(var array=chosenType[k].array,i=0;i<array.length;i++)for(var section=array[i],rules=section.rules,numDivs=this.$("."+section.divClass+" > div").length,j=0;numDivs>j;j++)if(!_.isUndefined(rules[j])&&rules[j].indexOf(chosenType[k].type)>=0)this.$("."+section.divClass+" > div:eq("+j+")").removeClass("hide");return this}})});